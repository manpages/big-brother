#!/bin/bash
eval "$(cat ./config)"
if [ ! -z $keydevice ]; then
  echo "Reading bytes from ${keydevice}"
  i=0
  while true; do
    pressed="$(echo $(sudo timeout 60 cat ${keydevice}))"
    count=$(expr "$(echo ${pressed} | wc -c - | cut -d\  -f1)" / 53)
    apm=$(expr ${count} \* 1)
    echo "APM â‰… ${apm}"
    echo "${i} ${apm}" >> /tmp/apm
    i=$(expr "$i" + 1)
  done
else
  if [ ! -z $keyfile ]; then 
    echo "Reading decoded key presses from ${keyfile} is not implemented."
  fi
fi
